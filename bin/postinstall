#!/usr/bin/env node

var path = require("path");
var virtualenv = require("../lib/virtualenv");

var isOptional = process.argv.indexOf("--optional") >= 0;
var forceReinstall = process.argv.indexOf("--force") >= 0;
var packagePath = require.resolve(path.join(process.cwd(), "./package.json"));
var env = virtualenv(packagePath);

function warn(err) {
  console.warn(err.stack);
  console.warn("Warning: optional Python helpers were not installed.");
}

env.install({force: forceReinstall}, function(err) {
  if (err) {
    if (isOptional) {
      warn(err);
      return;
    } else {
      throw err;
    }
  }
  console.log("Successfully installed Python helpers.");
});

if (isOptional) {
  process.on("uncaughtException", function(err) {
    warn(err);
  });
}